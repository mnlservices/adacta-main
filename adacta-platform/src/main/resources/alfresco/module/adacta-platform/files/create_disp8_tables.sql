-- To run this as postgres import: psql alfresco < ceate_disp8_tables.sql

-- CREATE TABLE DIS_P8_MDW
DROP TABLE IF EXISTS DIS_P8_MDW;
CREATE TABLE DIS_P8_MDW (
   STRBSN          CHAR(24),
   STREMPID        CHAR(11),
   STRMRN          CHAR(20),
   STRNAAM         CHAR(50),
   DATGEBOORTE     DATE,
   DATUITDIENST    DATE,
   STRROWSECCLASS  CHAR(30),
   STRSETID        CHAR(6)
);

-- CREATE TABLE DIS_P8_GBR
DROP TABLE IF EXISTS DIS_P8_GBR;
CREATE TABLE DIS_P8_GBR (
   STRGEBRUIKERID  CHAR(30),
   STRNAAM         CHAR(50),
   STRROWSECCLASS  CHAR(30),
   STRSETID        CHAR(6),
   STRAFDELING     CHAR(30)
);

-- CREATE TABLE ADACTA_DOSSIERS AND INDEXES
DROP TABLE IF EXISTS ADACTA_DOSSIERS;
CREATE TABLE ADACTA_DOSSIERS (
   STRBSN CHAR(24) NOT NULL,
   STREMPID CHAR(11),
   STRMRN CHAR(20),
   STRNAAM CHAR(50) NOT NULL,
   DATUITDIENST TIMESTAMP,
   STRSETID CHAR(6) NOT NULL,
   LASTCHANGEDATE TIMESTAMP NOT NULL
);
CREATE INDEX INDEX_LASTCHANGE ON ADACTA_DOSSIERS(LASTCHANGEDATE);
CREATE UNIQUE INDEX ADACTA_DOSSIERS_PK ON ADACTA_DOSSIERS(STRBSN);

-- POPULATE TABLE DIS_P8_MDW
INSERT INTO DIS_P8_MDW VALUES
('NLD-100000001','00000000001','600000001','Mdw Clientenadministratie, Maartje',TO_DATE('1958-12-15', 'yyyy-mm-dd'),NULL,'DPALL','KM'),
('NLD-100000001','00000000001','600000001','Mdw Clientenadministratie, Maartje',TO_DATE('1958-12-15', 'yyyy-mm-dd'),NULL,'DPEXMIVD','KM'),
('NLD-100000001','00000000001','600000001','Mdw Clientenadministratie, Maartje',TO_DATE('1958-12-15', 'yyyy-mm-dd'),NULL,'CDC','KM'),
('NLD-100000002','00000000002','600000002','Teamleider IC, Tim',TO_DATE('1965-09-02', 'yyyy-mm-dd'),NULL,'DPALL','DICO'),
('NLD-100000002','00000000002','600000002','Teamleider IC, Tim',TO_DATE('1965-09-02', 'yyyy-mm-dd'),NULL,'DPBS','DICO'),
('NLD-100000002','00000000002','600000002','Teamleider IC, Tim',TO_DATE('1965-09-02', 'yyyy-mm-dd'),NULL,'DPDMO','DICO'),
('NLD-100000003','00000000003','600000003','Functioneel beheerder, Frits',TO_DATE('1970-05-16', 'yyyy-mm-dd'),NULL,'DPALL','KL'),
('NLD-100000003','00000000003','600000003','Functioneel beheerder, Frits',TO_DATE('1970-05-16', 'yyyy-mm-dd'),NULL,'DP543','KL'),
('NLD-100000003','00000000003','600000003','Functioneel beheerder, Frits',TO_DATE('1970-05-16', 'yyyy-mm-dd'),NULL,'DPBSMIVD','KL'),
('NLD-100000003','00000000003','600000003','Functioneel beheerder, Frits',TO_DATE('1970-05-16', 'yyyy-mm-dd'),NULL,'DPEXMIVD','KL'),
('NLD-100000004','00000000004','600000004','Ondersteuner GZHC/Praktijkmngr, Otto',TO_DATE('1971-05-27', 'yyyy-mm-dd'),NULL,'DPALL','CO'),
('NLD-100000004','00000000004','600000004','Ondersteuner GZHC/Praktijkmngr, Otto',TO_DATE('1971-05-27', 'yyyy-mm-dd'),NULL,'DPBSMIVD','CO'),
('NLD-100000004','00000000004','600000004','Ondersteuner GZHC/Praktijkmngr, Otto',TO_DATE('1971-05-27', 'yyyy-mm-dd'),NULL,'DPDMO','CO'),
('NLD-100000004','00000000004','600000004','Ondersteuner GZHC/Praktijkmngr, Otto',TO_DATE('1971-05-27', 'yyyy-mm-dd'),NULL,'DPCDC','CO'),
('NLD-100000005','00000000005','600000005','Secretaris Vbdoff JZ Krm, Sonja',TO_DATE('1958-12-15', 'yyyy-mm-dd'),NULL,'DPALL','KM'),
('NLD-100000005','00000000005','600000005','Secretaris Vbdoff JZ Krm, Sonja',TO_DATE('1958-12-15', 'yyyy-mm-dd'),NULL,'DPEXMIVD','KM'),
('NLD-100000006','00000000006','600000006','Hfd Facilitaire Zkn, Hans',TO_DATE('1965-09-02', 'yyyy-mm-dd'),NULL,'DPALL','DICO'),
('NLD-100000007','00000000007','600000007','Sr Mdw Gemeentezaken, Sjouke',TO_DATE('1970-05-16', 'yyyy-mm-dd'),NULL,'DP543','KL'),
('NLD-100000007','00000000007','600000007','Sr Mdw Gemeentezaken, Sjouke',TO_DATE('1970-05-16', 'yyyy-mm-dd'),NULL,'DPBSMIVD','KL'),
('NLD-100097874','00000097874','600008187','Groenewegen, Ingmar',TO_DATE('1970-10-10', 'yyyy-mm-dd'),NULL,'DPALL','KL'),
('NLD-100097874','00000097874','600008187','Groenewegen, Ingmar',TO_DATE('1970-10-10', 'yyyy-mm-dd'),NULL,'DPKMAR','KL');

-- POPULATE TABLE DIS_P8_GBR
INSERT INTO DIS_P8_GBR VALUES
('V0000001','Mdw Clientenadministratie, Maartje','DPEXMIVD','KM','EHV:BUREAU P&O'),
('V0000002','Teamleider IC, Tim','DPDMO','DICO','DC Human Resources & Rechtspos'),
('V0000003','Functioneel beheerder, Frits','DPALL','KL','DC Organisatie & Formatie'),
('V0000004','Ondersteuner GZHC/Praktijkmngr, Otto','DPCDC','CO','DHC:STAF'),
('V0000005','Secretaris Vbdoff JZ Krm, Sonja','DPBSMIVD','KM','EHV:BUREAU P&O'),
('V0000006','Hfd Facilitaire Zkn, Hans','DPALL','DICO','DC Human Resources & Rechtspos'),
('V0000007','Sr Mdw Gemeentezaken, Sjouke','DPCLSK','KL','DC Organisatie & Formatie'),
('V0097874','Groenewegen, Ingmar','DPALL','KL','DC Organisatie & Formatie');

-- POPULATE TABLE ADACTA_DOSSIERS
INSERT INTO ADACTA_DOSSIERS VALUES
('NLD-100000001','00000000001','600000001','Mdw Clientenadministratie, Maartje',NULL,'KM',TO_TIMESTAMP('2017-09-20 12:20:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100000002','00000000002','600000002','Teamleider IC, Tim',NULL,'DICO',TO_TIMESTAMP('2017-09-21 11:10:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100000003','00000000003','600000003','Functioneel beheerder, Frits',NULL,'KL',TO_TIMESTAMP('2017-09-22 12:05:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100000004','00000000004','600000004','Ondersteuner GZHC/Praktijkmngr, Otto',NULL,'CO',TO_TIMESTAMP('2017-09-23 09:20:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100000005','00000000005','600000005','Secretaris Vbdoff JZ Krm, Sonja',NULL,'KM',TO_TIMESTAMP('2017-10-09 10:30:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100000006','00000000006','600000006','Hfd Facilitaire Zkn, Hans',NULL,'DICO',TO_TIMESTAMP('2017-10-10 14:45:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100000007','00000000007','600000007','Sr Mdw Gemeentezaken, Sjouke',NULL,'KL',TO_TIMESTAMP('2017-10-11 14:20:00', 'yyyy-mm-dd hh24:mi:ss')),
('NLD-100097874','00000097874','600008187','Groenewegen, Ingmar',NULL,'KL',TO_TIMESTAMP('2017-10-15 14:20:00', 'yyyy-mm-dd hh24:mi:ss'));

COMMIT;

-- EXAMPLES OF SELECT STATEMENTS
-- SELECT * FROM ADACTA_DOSSIERS WHERE TO_DATE('2017-10-05', 'yyyy-mm-dd') < LASTCHANGEDATE;
-- SELECT * FROM ADACTA_DOSSIERS WHERE STRBSN = 'NLD-100000001';
-- SELECT * FROM DIS_P8_MDW WHERE STREMPID = '00000000001';
-- SELECT * FROM DIS_P8_GBR WHERE STRGEBRUIKERID = 'V0000003';
-- SELECT B.STRBSN, B.STREMPID, B.STRMRN, B.STRNAAM, B.DATGEBOORTE, B.DATUITDIENST, B.STRSETID, C.STRAFDELING, B.STRROWSECCLASS AS DP_CODES, C.STRROWSECCLASS AS DP_CODE FROM DIS_P8_MDW B, DIS_P8_GBR C WHERE REGEXP_LIKE (C.STRGEBRUIKERID, CONCAT('[A-Z]', SUBSTR(B.STREMPID, 5))) AND B.STREMPID = '00000000004'

-- EXAMPLE OF UPDATE STATEMENT
-- UPDATE DIS_P8_MDW SET STRNAAM = 'Test, Test' WHERE STRBSN = 'NLD-100000001'; -- 'Mdw Clientenadministratie, Maartje'