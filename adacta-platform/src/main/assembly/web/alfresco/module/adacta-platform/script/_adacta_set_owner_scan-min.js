function main(){if(document&&document.isSubType("cm:content")){var c=document.parent;var f=document.properties["ada:scanBatchName"];var g=c.children.length;var d="";var e=f.split("_");if(e.length===3){d=e[0].toString()}else{logger.warn("Folder name not correct.")}if(d!==null&&d!==""){var a=document.properties["ada:scanBatchSize"];if(a===g){var b=[];b["ada:scanEmployee"]=d;b["ada:scanWaNr"]=e[1];b["ada:scanSeqNr"]=e[2];c.addAspect("ada:scanAspect",b);c.setPermission("Coordinator",d);c.setOwner(d);grantDepartmentAccess(c,d);c.children.forEach(function(h){if(h.typeShort!=="ada:document"){return}h.properties["ada:docDateCreated"]=h.properties["cm:created"];h.save()})}}else{adacta.warn("No username exist on document "+document.name)}}}function grantDepartmentAccess(c,d){var b=people.getPerson(d);var e=b.properties["cm:organization"];if(!e||e.length<1){logger.log("Scanner has no organization for "+child.name);return}var a=getScanGroup(e);if(a!==null){c.setPermission("Coordinator",a.properties["cm:authorityName"])}}function getScanGroup(h){var b=h.split("/");var g=null;var e=h.toUpperCase();if(e.indexOf("DOSCO")===0||e.indexOf("CZSK")===0||e.indexOf("BS")===0){if(b.length<3){g=h}else{g=b.splice(0,3).join("/")}}else{if(e.indexOf("CLAS")===0||e.indexOf("CLSK")===0||e.indexOf("DMO")===0||e.indexOf("KMAR")===0){if(b.length<2){g=h}else{g=b.splice(0,2).join("/")}}else{g=h}}g+=" (Afdeling-rolgroep)";var a='=TYPE:"cm:authorityContainer" AND +@cm\\:authorityDisplayName:"'+g+'"';var c=search.query({store:"workspace://SpacesStore",language:"fts-alfresco",query:a});for(var d=0;d<c.length;d++){var j=c[d];var f=j.properties["cm:authorityDisplayName"];if(f.toLowerCase()===g.toLowerCase()){return j}}logger.log("No matching group for "+g);return null}main();